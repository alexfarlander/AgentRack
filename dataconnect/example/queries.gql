mutation CreateUser($displayName: String, $email: String!, $googleId: String!, $photoUrl: String, $refreshToken: String) @auth(level: USER) {
  user_insert(data: { displayName: $displayName, email: $email, googleId: $googleId, photoUrl: $photoUrl, refreshToken: $refreshToken, createdAt_expr: "request.time" })
}

mutation UpdateUser($googleId: String!, $refreshToken: String) @auth(level: USER) {
  user_updateMany(
    where: { googleId: { eq: $googleId } },
    data: { refreshToken: $refreshToken }
  )
}

query GetAgentsForUser @auth(level: USER) {
  agents(where: { userId: { eq_expr: "auth.uid" } }) {
    id
    name
    type
    status
    schedule
    settings
    lastRun
    createdAt
  }
}

mutation CreateAgentWithId($id: UUID!, $name: String!, $type: String!, $status: String!, $schedule: String, $settings: String) @auth(level: USER) {
  agent_insert(data: {
    id: $id,
    name: $name,
    type: $type,
    status: $status,
    schedule: $schedule,
    settings: $settings,
    userId_expr: "auth.uid",
    createdAt_expr: "request.time"
  })
}

mutation UpdateAgent($id: UUID!, $name: String, $type: String, $status: String, $schedule: String, $settings: String, $lastRun: Timestamp) @auth(level: USER) {
  agent_update(
    id: $id,
    data: {
      name: $name,
      type: $type,
      status: $status,
      schedule: $schedule,
      settings: $settings,
      lastRun: $lastRun
    }
  )
}

mutation DeleteAgent($id: UUID!) @auth(level: USER) {
  agent_delete(id: $id)
}

query GetAgent($id: UUID!) @auth(level: USER) {
  agent(id: $id) {
    id
    name
    type
    status
    settings
    lastRun
  }
}

mutation CreateRun($agentId: UUID!, $status: String!, $details: String!, $logs: [String!]) @auth(level: USER) {
  run_insert(data: {
    agentId: $agentId,
    status: $status,
    details: $details,
    logs: $logs,
    timestamp_expr: "request.time"
  })
}